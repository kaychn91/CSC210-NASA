<DOCTYPE! html>
	<head>
		<title> NASA - Gaming Site </title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<!-- <script type="text/javascript" src="script.js"> -->
			
		<!-- </script> -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script>
		
			$(document).ready(function(){
				$("#contentpage").prop('src',sessionStorage.navlink);
				var loggedin = "";
				function getCookie() {
					var cks = document.cookie.split(';');
					var n = 0;
					var uname="";
					for(var i = 0;i<cks.length;i++)
					{
						n = cks[i].search("username=")
						if(n!=-1){
						var x = cks[i].split("username=")
						uname = x[1];
						break;
						}
					}
					if(n == -1)
						return "";
					else
					{
						sessionStorage.username = uname;
						return uname;
					}
				}
				loggedin = getCookie();
				function hide_sign_out()
				{
					$(".SignOut").hide();
					$(".SignIn").show();
					$("#TAComment").prop('disabled',true);
					$("#submitcomment").prop('disabled',true)
				}
				function hide_sign_in()
				{
					$(".SignIn").hide();
					$("#userid").text(loggedin);
					$(".SignOut").show();
					$("#TAComment").prop('disabled',false);
					$("#submitcomment").prop('disabled',false)
				}
				if(loggedin == "")
				{
					hide_sign_out();
				}
				else
				{
					hide_sign_in();
				}
				$("#sign_in").click(function (){
						var user = $("#username").val();
						if( user !="" && $("#password").val() != "")
						{
							$.ajax({
								url: "/cgi-bin/verify_user_login.py",
								data: {username: user, password: $("#password").val() },
								datatype: "application/json",
								type: "get",
								success: function(response){
									if(response.result){
										if($("#rememberme").prop("checked")){
											var expires = new Date();
											expires.setTime(expires.getTime() + (30*24*60*60*1000));
											document.cookie = "username=" + user+"; expires= "+expires.toUTCString();
										}
										else
										{
											document.cookie="username="+user+";";
										}
										loggedin=getCookie();
										sessionStorage.username = user;
										hide_sign_in();
									}
									else
									{
										alert("Wrong Username/password")
									}
								},
								error: function(response){
									alert("error");
								}
							});
						}
						else
						{
							alert("Enter Username/password");
						}	
					});
				$("#sign_out").click(function (){
					document.cookie= "username=; expires = Thu, 01 Jan 1970 00:00:00 UTC";
					loggedin = getCookie();
					hide_sign_out();
				});
				
				//insert comment
				$("#submitcomment").click(function () {
					var user = sessionStorage.username;
					var commenttext = $("#TAComment").val().trim();
					if(commenttext!="")
					{
						$.ajax({
							url: "/cgi-bin/CommentData.py",
							data: {username: user, articleID: 1, fnc: 'submitcomment', comment_text: commenttext},
							datatype: "application/json",
							type: "get",
							success: function(response){
								//show comments
								show_comments();
								$("#TAComment").val("");
							},
							error: function(response){
								alert("error in inserting comments");
							}
						});
					}
					else
					{
						alert("Text area cannot be blank");
					}
				});
				//show comments
				function show_comments(){
				$("#comments_area").html("");
					var username ="";
					var comment_text = "";
					var commentid = 0;
					$.ajax({
						url: "cgi-bin/CommentData.py",
						data:{fnc: 'GetComments', articleID: 1},
						datatype: "application/json",
						type: "get",
						success: function(response){
							//displays commentss
							$.each(response.result, function(index, value) {
								username = value[0];
								commentid = value[1];
								comment_text = value[2];
								if(username!="")
								{
									var comments_html = '<br><textarea id="' + commentid + ' rows="4" cols="50" disabled="true" style="resize: none;">'+comment_text+'</textarea><br>'
									$("#comments_area").append(comments_html);
								}
							});
						},
						error: function(response){
							alert("alert getting comments in python scritp")
						}
					});
				}
				show_comments();
				$(".top-level-menu").click(function(e) {
				var parent = $(e.target).parent().parent().attr('class');
				if(parent.indexOf("level-menu")>0)
					sessionStorage.navlink = $(e.target).attr('href');
				});				
			});
			function resizeIframe(iframe) {
				iframe.height = $('#contentpage').contents().find("html").height() + "px";
			}
		</script>
	</head>


	<body>

		<header>
			<img src="images/logo2.png" alt="logo" height="125" width="275">
		</header>
		<ul class="sign-in">
			<li class = "SignIn">
				<!-- <form method="get" action="/cgi-bin/verify_user_login.py"> -->
       					<p>Username: <input type="text" name="username" id="username" required/><BR></p>
       					<p>Password: <input type="password" id="password" name="password" required/><BR></p>
						Remember me<input type="checkbox" id="rememberme">
        				<button type="button" id="sign_in">Sign In</button> &nbsp &nbsp <br/> No account? &nbsp<a href="createaccount.html">Sign Up</a>&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp 
    				<!-- </form>					 -->
			</li>
			<li class = "SignOut">
				<p>Welcome, <a id="userid" /></p><BR>
				<button type="button" id="sign_out">Sign Out</button>
			</li>
		</ul>
		
		<ul class="top-level-menu">
			<li class = 'Home'><a class= "active" target="content" href="home_articles.html"> Home </a></li>
			<li class = "PC"><a target='content' href ='pc.html'> PC </a></li>				
			<li class = "Nintendo"><a target = "content" href='nintendo.html'> Nintendo </a>
				<ul class="second-level-menu">
					<li><a target = "content" href='NhomeConsoles.html'> Home Consoles </a>	
						<ul class="third-level-menu">
							<li><a target = "content" href='NES.html'> NES </a></li>						
							<li><a target = "content" href='SNES.html'> SNES </a></li>
							<li><a target = "content" href='N64.html'> N64 </a></li>
							<li><a target = "content" href='Gamecube.html'> GameCube </a></li>
							<li><a target = "content" href='Wii.html'> Wii </a></li>
							<li><a target = "content" href='WiiU.html'> Wii U </a></li>			
						</ul> 
					</li>
					<li><a target = "content" href='NPortableConsoles.html'> Portable Consoles </a>
						<ul class="third-level-menu">
							<li><a target = "content" href='GameAndWatch.html'> Game and Watch </a></li>
							<li><a target = "content" href='GameBoy.html'> Game Boy </a></li>
							<li><a target = "content" href='VirtualBoy.html'> Virtual Boy </a></li>
							<li><a target = "content" href='GameBoyC.html'> Game Boy Color </a></li>		
							<li><a target = "content" href='GameBoyA.html'> Game Boy Advance </a></li>
							<li><a target = "content" href='DS.html'> Nintendo DS </a></li>
							<li><a target = "content" href='3DS.html'> Nintendo 3DS </a></li>
						</ul> 
					</li>
				</ul>
			</li>
			<li class = "Sony"><a target='content' href = 'Sony.html'> Sony </a>
				<ul class="second-level-menu">
					<li><a target = "content" href='Playstation.html'> PlayStation</a></li>
					<li><a target = "content" href='Playstation2.html'> PlayStation 2 </a></li>
					<li><a target = "content" href='Playstation3.html'> PlayStation 3</a></li>
					<li><a target = "content" href='Playstation4.html'> PlayStation 4 </a></li>		
					<li><a target = "content" href='PlaystationP.html'> PlayStation Portable </a></li>
					<li><a target = "content" href='playstation_tv.html'> PlayStation TV </a></li>
					<li><a target = "content" href='playstation_vita.html'> PlayStation Vita </a></li>
				</ul>
			</li>
			<li class = "Microsoft"><a target='content' href = 'microsoft.html'> Microsoft </a>
				<ul class="second-level-menu">
					<li><a target = "content" href='xbox.html'> Xbox</a></li>
					<li><a target = "content" href='xbox360.html'> Xbox 360 </a></li>
					<li><a target = "content" href='xbox1.html'> Xbox One</a></li>
				</ul>
			</li>
			<li class = "Other"><a target='content' href = 'other.html'> Other </a></li>
			<li class = "Contribute"><a target='content' href = 'contribute.html'> Contribute </a></li>
		</ul>
		
		<br>
		<br />
		<iframe onload="resizeIframe(this)" id="contentpage" name='content' src=home_articles.html></iframe>
		<div class="DivComment">

			Comment Section
			<br>
			<div id="comments_area">
			</div>
			<br>
			<textarea id="TAComment" rows="4" cols="50" disabled="true" style="resize: none;"></textarea><br>
			<input type="button" id="submitcomment" value="Submit" disabled=true"/>
		</div>
	</body>
</html>

